var t;

t = t || {};

$(document).ready(function() {
  t.char_counter();
  t.xhr_load();
  return true;
});
t.timeline = function() {
  return true;
};
t.char_counter = function() {
  var $charcounter, $telegram, $transmit;
  $telegram = $('#telegram');
  $transmit = $('#transmit');
  $charcounter = $('.charcounter');
  return $telegram.on('keyup', function() {
    var available_chars, remaining_chars, str_len;
    available_chars = 256;
    str_len = $telegram.val().length;
    remaining_chars = available_chars - str_len;
    $charcounter.text(remaining_chars);
    if (remaining_chars < 0) {
      $charcounter.addClass('warning');
      return $transmit.attr('disabled', 'disabled');
    } else {
      $charcounter.removeClass('warning');
      return $transmit.attr('disabled', false);
    }
  });
};
t.run_xhr = true;

t.xhr_step = 10;

t.xhr_load = function() {
  var $xhr, xhr_url;
  $xhr = $('.xhr');
  xhr_url = $xhr.data('xhr-url');
  if (xhr_url) {
    if (xhr_url.indexOf('?') > -1) {
      xhr_url += '&step=' + t.xhr_step;
    } else {
      xhr_url += '?step=' + t.xhr_step;
    }
    if (t.run_xhr) {
      t.run_xhr = false;
      return $.get(xhr_url, function(data) {
        if (data.length > 1) {
          $xhr.append(data);
          t.xhr_step = t.xhr_step + 10;
          return t.run_xhr = true;
        } else {
          return t.run_xhr = false;
        }
      });
    }
  }
};
